# ?? Joke Agents Demo - Microsoft Agent Framework A2A

A demonstration of **Agent-to-Agent (A2A) Communication** using the official **Microsoft Agent Framework (MAF)** APIs.

## ? What This Demonstrates

- **Official MAF A2A Protocol**: Using `MapA2A()`, `A2AClient`, and `GetAIAgent()` APIs
- **Multi-Agent Collaboration**: Two AI agents working together iteratively
- **Agent Hosting**: Automatic Agent Card generation and endpoint creation
- **Remote Agent Discovery**: A2AClient discovering and calling remote agents
- **Iterative Refinement**: Agents improving output through feedback loops

---

## ??? Architecture

```
???????????????????????????????
?    Web UI (Browser)         ?
?  http://localhost:5000      ?
???????????????????????????????
           ? POST /api/jokes/create
           ?
???????????????????????????????
?  Orchestration Endpoint     ?
?  • Manages iteration loop   ?
?  • Coordinates agents       ?
???????????????????????????????
       ?              ?
       ? Local        ? A2A Protocol (HTTP)
       ?              ?
???????????????  ????????????????????
?JokeCreator  ?  ?   A2AClient      ?
?(Local)      ?  ?   • Discovery    ?
?• Creates    ?  ?   • Proxy        ?
?• Improves   ?  ????????????????????
???????????????       ? HTTP POST
                      ?
              ??????????????????????
              ? /agents/critic     ?
              ? (MapA2A Endpoint)  ?
              ? ?????????????????? ?
              ? ?  JokeCritic    ? ?
              ? ?  • Evaluates   ? ?
              ? ?  • Rates 1-10  ? ?
              ? ?  • Provides    ? ?
              ? ?    Feedback    ? ?
              ? ?????????????????? ?
              ??????????????????????
```

---

## ?? Quick Start

### Prerequisites
- .NET 10 SDK
- Azure OpenAI access
- Azure CLI (`az login`)

### Run the Demo

```bash
cd JokeAgentsDemo
dotnet run
```

Open browser: **http://localhost:5000**

---

## ?? Key Features

### 1. **Official MAF A2A APIs**

```csharp
// ? Agent hosting with automatic Agent Card
app.MapA2A(criticAgent, "/agents/critic");

// ? Remote agent discovery
var a2aClient = new A2AClient(new Uri("http://localhost:5000/agents/critic"));

// ? Agent proxy creation
var remoteCritic = a2aClient.GetAIAgent(
    id: "joke-critic",
    name: "JokeCritic",
    description: "Remote joke evaluation agent",
    displayName: "Joke Critic",
    loggerFactory: loggerFactory);

// ? Transparent remote invocation
var response = await remoteCritic.RunAsync(prompt);
```

### 2. **Two Specialized Agents**

**JokeCreator Agent** ??
- Creates original, funny jokes
- Improves jokes based on feedback
- Focuses on deliverability and performance

**JokeCritic Agent** ??
- Evaluates jokes on 6 criteria
- Provides detailed constructive feedback
- Rates jokes from 1-10
- Ensures jokes are single, performable, and conversational

### 3. **Iterative Refinement**

The orchestrator runs up to 5 iterations:
1. JokeCreator creates initial joke
2. JokeCritic evaluates via A2A protocol
3. If rating < 8: JokeCreator improves based on feedback
4. Repeat until rating ? 8 or max iterations

---

## ?? NuGet Packages

```xml
<PackageReference Include="Azure.AI.OpenAI" Version="2.1.0" />
<PackageReference Include="Azure.Identity" Version="1.13.1" />
<PackageReference Include="Microsoft.Agents.AI.OpenAI" Version="1.0.0-preview.251125.1" />
<PackageReference Include="Microsoft.Agents.AI.A2A" Version="1.0.0-preview.251125.1" />
<PackageReference Include="Microsoft.Agents.AI.Hosting.A2A.AspNetCore" Version="1.0.0-preview.251125.1" />
<PackageReference Include="Microsoft.Agents.AI.Workflows.Declarative" Version="1.0.0-preview.251125.1" />
```

---

## ?? API Endpoints

### Agent Endpoints (Auto-generated by MapA2A)

- `POST /agents/critic` - JokeCritic invocation
- `GET /agents/critic/.well-known/agent.json` - JokeCritic Agent Card
- `POST /agents/creator` - JokeCreator invocation  
- `GET /agents/creator/.well-known/agent.json` - JokeCreator Agent Card

### Application Endpoints

- `GET /` - Web UI
- `POST /api/jokes/create?topic={topic}` - Create funny joke with A2A orchestration
- `GET /health` - Health check

---

## ?? How A2A Protocol Works

### Step 1: Agent Hosting
```csharp
app.MapA2A(criticAgent, "/agents/critic");
```
- Creates HTTP endpoint
- Generates Agent Card automatically
- Handles A2A protocol messages
- Manages agent state

### Step 2: Remote Discovery
```csharp
var a2aClient = new A2AClient(new Uri("http://localhost:5000/agents/critic"));
var remoteAgent = a2aClient.GetAIAgent(...);
```
- Connects to remote agent
- Creates local proxy
- Handles serialization

### Step 3: Transparent Invocation
```csharp
var response = await remoteAgent.RunAsync("Evaluate this joke...");
```
- Calls remote agent via HTTP
- Uses A2A protocol
- Returns structured response

---

## ?? For Lectures/Demos

### Demo Script (15 minutes)

**Minutes 0-3: Introduction**
- Show web UI at http://localhost:5000
- Explain the two agents and their roles

**Minutes 3-5: Show Official APIs**
- Open `Program.cs`
- Highlight `MapA2A()`
- Highlight `A2AClient.GetAIAgent()`
- Emphasize: **These are OFFICIAL MAF APIs**

**Minutes 5-10: Live Demo**
- Create a joke about "programming"
- Watch console logs showing A2A calls
- Show iteration process
- Highlight final rating

**Minutes 10-12: Agent Cards**
- Navigate to `/.well-known/agent.json` for each agent
- Explain auto-generation
- Show JSON structure

**Minutes 12-15: Q&A**
- Production deployment scenarios
- Distributed agent architectures
- Microsoft 365 Copilot extensibility

---

## ?? Production Deployment

### Deploy to Separate Services

```bash
# Deploy Critic Agent
az webapp create --name joke-critic-prod \
  --resource-group rg-agents \
  --runtime "DOTNET|10.0"

# Deploy Creator Agent (if needed separately)
az webapp create --name joke-creator-prod \
  --resource-group rg-agents \
  --runtime "DOTNET|10.0"
```

### Update Configuration

```csharp
// Point to remote service
var a2aClient = new A2AClient(
    new Uri("https://joke-critic-prod.azurewebsites.net/agents/critic"));
```

**Benefits:**
- ? Independent scaling
- ? Isolated failures
- ? Geographic distribution
- ? Version control per agent

---

## ?? Testing

Use the included `JokeAgentsDemo.http` file:

```http
### Create a joke about programming
POST http://localhost:5000/api/jokes/create?topic=programming
Content-Type: application/json

### Get Agent Card
GET http://localhost:5000/agents/critic/.well-known/agent.json

### Health Check
GET http://localhost:5000/health
```

---

## ? Benefits of Official MAF Implementation

| Feature | Manual Implementation | Official MAF |
|---------|----------------------|--------------|
| **Agent Cards** | ? Manual JSON | ? Auto-generated |
| **Routing** | ? Custom endpoints | ? `MapA2A()` |
| **Discovery** | ? HttpClient | ? `A2AClient` |
| **Protocol** | ?? Best effort | ? Compliant |
| **Observability** | ?? Custom | ? Built-in |
| **State Management** | ? Manual | ? Automatic |

---

## ?? Learn More

- [Microsoft Agent Framework](https://learn.microsoft.com/agent-framework/)
- [GitHub Repository](https://github.com/microsoft/agent-framework)
- [Discord Community](https://discord.gg/b5zjErwbQM)
- [Semantic Kernel Blog](https://devblogs.microsoft.com/semantic-kernel/)

---

## ?? Summary

This project demonstrates:
- ? **Real MAF A2A APIs** - Not a simulation
- ? **Production patterns** - Scalable, distributed agent systems
- ? **Simple code** - Framework handles complexity
- ? **Protocol compliance** - Official A2A specification
- ? **Educational** - Perfect for learning and teaching

**Perfect for teaching, learning, and building production multi-agent systems!** ????
